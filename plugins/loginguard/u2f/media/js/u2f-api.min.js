(function(){var l="chrome"in window&&0>window.navigator.userAgent.indexOf("Edge");if(!("u2f"in window)&&l){var a=window.u2f={},k;a.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd";a.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"};a.ErrorCodes={OK:0,OTHER_ERROR:1,
BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5};a.getMessagePort=function(b){"undefined"!=typeof chrome&&chrome.runtime?chrome.runtime.sendMessage(a.EXTENSION_ID,{type:a.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]},function(){chrome.runtime.lastError?a.getIframePort_(b):a.getChromeRuntimePort_(b)}):a.isAndroidChrome_()?a.getAuthenticatorPort_(b):a.isIosChrome_()?a.getIosPort_(b):a.getIframePort_(b)};a.isAndroidChrome_=function(){var a=navigator.userAgent;return-1!=a.indexOf("Chrome")&&
-1!=a.indexOf("Android")};a.isIosChrome_=function(){return-1<["iPhone","iPad","iPod"].indexOf(navigator.platform)};a.getChromeRuntimePort_=function(b){var d=chrome.runtime.connect(a.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){b(new a.WrappedChromeRuntimePort_(d))},0)};a.getAuthenticatorPort_=function(b){setTimeout(function(){b(new a.WrappedAuthenticatorPort_)},0)};a.getIosPort_=function(b){setTimeout(function(){b(new a.WrappedIosPort_)},0)};a.WrappedChromeRuntimePort_=function(a){this.port_=
a};a.formatSignRequest_=function(b,d,c,e,g){if(void 0===k||1.1>k){for(var f=[],h=0;h<c.length;h++)f[h]={version:c[h].version,challenge:d,keyHandle:c[h].keyHandle,appId:b};return{type:a.MessageTypes.U2F_SIGN_REQUEST,signRequests:f,timeoutSeconds:e,requestId:g}}return{type:a.MessageTypes.U2F_SIGN_REQUEST,appId:b,challenge:d,registeredKeys:c,timeoutSeconds:e,requestId:g}};a.formatRegisterRequest_=function(b,d,c,e,g){if(void 0===k||1.1>k){for(var f=0;f<c.length;f++)c[f].appId=b;for(var h=[],f=0;f<d.length;f++)h[f]=
{version:d[f].version,challenge:c[0],keyHandle:d[f].keyHandle,appId:b};return{type:a.MessageTypes.U2F_REGISTER_REQUEST,signRequests:h,registerRequests:c,timeoutSeconds:e,requestId:g}}return{type:a.MessageTypes.U2F_REGISTER_REQUEST,appId:b,registerRequests:c,registeredKeys:d,timeoutSeconds:e,requestId:g}};a.WrappedChromeRuntimePort_.prototype.postMessage=function(a){this.port_.postMessage(a)};a.WrappedChromeRuntimePort_.prototype.addEventListener=function(a,d){var c=a.toLowerCase();"message"==c||"onmessage"==
c?this.port_.onMessage.addListener(function(a){d({data:a})}):console.error("WrappedChromeRuntimePort only supports onMessage")};a.WrappedAuthenticatorPort_=function(){this.requestId_=-1;this.requestObject_=null};a.WrappedAuthenticatorPort_.prototype.postMessage=function(b){b=a.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(b))+";end";document.location=b};a.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"};a.WrappedAuthenticatorPort_.prototype.addEventListener=
function(a,d){"message"==a.toLowerCase()?window.addEventListener("message",this.onRequestUpdate_.bind(this,d),!1):console.error("WrappedAuthenticatorPort only supports message")};a.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(a,d){var c=JSON.parse(d.data),e=null;c.hasOwnProperty("data")&&(e=JSON.parse(c.data));a({data:e})};a.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE";a.WrappedIosPort_=function(){};a.WrappedIosPort_.prototype.postMessage=
function(a){a=JSON.stringify(a);a="u2f://auth?"+encodeURI(a);location.replace(a)};a.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"};a.WrappedIosPort_.prototype.addEventListener=function(a,d){"message"!==a.toLowerCase()&&console.error("WrappedIosPort only supports message")};a.getIframePort_=function(b){var d="chrome-extension://"+a.EXTENSION_ID,c=document.createElement("iframe");c.src=d+"/u2f-comms.html";c.setAttribute("style","display:none");document.body.appendChild(c);
var e=new MessageChannel,g=function(a){"ready"==a.data?(e.port1.removeEventListener("message",g),b(e.port1)):console.error('First event on iframe port was not "ready"')};e.port1.addEventListener("message",g);e.port1.start();c.addEventListener("load",function(){c.contentWindow.postMessage("init",d,[e.port2])})};a.EXTENSION_TIMEOUT_SEC=30;a.port_=null;a.waitingForPort_=[];a.reqCounter_=0;a.callbackMap_={};a.getPortSingleton_=function(b){a.port_?b(a.port_):(0==a.waitingForPort_.length&&a.getMessagePort(function(b){a.port_=
b;for(a.port_.addEventListener("message",a.responseHandler_);a.waitingForPort_.length;)a.waitingForPort_.shift()(a.port_)}),a.waitingForPort_.push(b))};a.responseHandler_=function(b){b=b.data;var d=b.requestId;if(!d||!a.callbackMap_[d])console.error("Unknown or missing requestId in response.");else{var c=a.callbackMap_[d];delete a.callbackMap_[d];c(b.responseData)}};a.sign=function(b,d,c,e,g){void 0===k?a.getApiVersion(function(f){k=void 0===f.js_api_version?0:f.js_api_version;console.log("Extension JS API Version: ",
k);a.sendSignRequest(b,d,c,e,g)}):a.sendSignRequest(b,d,c,e,g)};a.sendSignRequest=function(b,d,c,e,g){a.getPortSingleton_(function(f){var h=++a.reqCounter_;a.callbackMap_[h]=e;h=a.formatSignRequest_(b,d,c,"undefined"!==typeof g?g:a.EXTENSION_TIMEOUT_SEC,h);f.postMessage(h)})};a.register=function(b,d,c,e,g){void 0===k?a.getApiVersion(function(f){k=void 0===f.js_api_version?0:f.js_api_version;console.log("Extension JS API Version: ",k);a.sendRegisterRequest(b,d,c,e,g)}):a.sendRegisterRequest(b,d,c,
e,g)};a.sendRegisterRequest=function(b,d,c,e,g){a.getPortSingleton_(function(f){var h=++a.reqCounter_;a.callbackMap_[h]=e;h=a.formatRegisterRequest_(b,c,d,"undefined"!==typeof g?g:a.EXTENSION_TIMEOUT_SEC,h);f.postMessage(h)})};a.getApiVersion=function(b,d){a.getPortSingleton_(function(c){if(c.getPortType){switch(c.getPortType()){case "WrappedIosPort_":case "WrappedAuthenticatorPort_":c=1.1;break;default:c=0}b({js_api_version:c})}else{var e=++a.reqCounter_;a.callbackMap_[e]=b;c.postMessage({type:a.MessageTypes.U2F_GET_API_VERSION_REQUEST,
timeoutSeconds:"undefined"!==typeof d?d:a.EXTENSION_TIMEOUT_SEC,requestId:e})}})}}})(); //# sourceMappingURL=u2f-api.map
