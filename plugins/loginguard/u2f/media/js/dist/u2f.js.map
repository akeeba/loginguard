{"version":3,"sources":["../u2f.js"],"names":["akeeba","LoginGuard","u2f","regData","authData","handlingError","setUp","e","preventDefault","Joomla","getOptions","u2fRequest","u2fAuthorization","register","appId","setUpCallback","data","errorCode","document","getElementById","value","JSON","stringify","forms","submit","showError","alert","JText","_","style","disabled","validate","sign","challenge","validateCallback","response","window","addEventListener","querySelectorAll","forEach","elButton"],"mappings":"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","sourcesContent":["/*!\n * @package   AkeebaLoginGuard\n * @copyright Copyright (c)2016-2021 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   GNU General Public License version 3, or later\n */\n\n// Namespace\nvar akeeba = akeeba || {};\n\nakeeba.LoginGuard = akeeba.LoginGuard || {};\n\nakeeba.LoginGuard.u2f = akeeba.LoginGuard.u2f || {\n    regData:       null,\n    authData:      null,\n    handlingError: false\n};\n\n/**\n * Register a new U2F security key.\n */\nakeeba.LoginGuard.u2f.setUp = function (e)\n{\n    e.preventDefault();\n\n    akeeba.LoginGuard.u2f.regData = Joomla.getOptions(\"akeeba.LoginGuard.u2f.regData\", [\"\", \"\"]);\n\n    var u2fRequest       = akeeba.LoginGuard.u2f.regData[0];\n    var u2fAuthorization = akeeba.LoginGuard.u2f.regData[1];\n\n    u2f.register(u2fRequest.appId, [u2fRequest], u2fAuthorization, akeeba.LoginGuard.u2f.setUpCallback);\n\n    return false;\n};\n\n/**\n * Callback for the U2F register() method\n *\n * @param   {u2f.RegisterResponse}  data\n */\nakeeba.LoginGuard.u2f.setUpCallback = function (data)\n{\n    if ((data.errorCode === undefined) || (data.errorCode === 0))\n    {\n        // Store the U2F reply\n        document.getElementById(\"loginguard-method-code\").value = JSON.stringify(data);\n\n        // Submit the form\n        document.forms[\"loginguard-method-edit\"].submit();\n\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.showError(data.errorCode);\n};\n\n/**\n * Display an error when the U2F JS API responds with an errorCode\n *\n * @param   {int}  errorCode\n */\nakeeba.LoginGuard.u2f.showError = function (errorCode)\n{\n    /**\n     * Firefox sends two responses with error codes 4 and 1 when the device is already registered. Using this trick\n     * we only display the relevant error message (4), discarding the secondary generic error.\n     */\n    if (akeeba.LoginGuard.u2f.handlingError)\n    {\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.handlingError = true;\n\n    switch (errorCode)\n    {\n        case 1:\n        default:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_OTHER\") + \" // \" + errorCode);\n            break;\n\n        case 2:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_CANNOTPROCESS\"));\n            break;\n\n        case 3:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_CLIENTCONFIGNOTSUPPORTED\"));\n            break;\n\n        case 4:\n            if (Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE_SIGN\") != \"\")\n            {\n                alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE_SIGN\"));\n\n                break;\n            }\n\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE\"));\n            break;\n\n        case 5:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_TIMEOUT\"));\n\n            break;\n    }\n\n    try\n    {\n        document.getElementById('loginguard-captive-button-submit').style.disabled = null;\n    }\n    catch (e)\n    {\n    }\n\n    akeeba.LoginGuard.u2f.handlingError = false;\n};\n\n/**\n * Ask the U2F key to sign a challenge (validation)\n */\nakeeba.LoginGuard.u2f.validate = function ()\n{\n    // This line was valid for U2F Javascript API 1.0 which is no longer supported ;(\n    // u2f.sign(akeeba.LoginGuard.u2f.authData, akeeba.LoginGuard.u2f.validateCallback);\n\n    akeeba.LoginGuard.u2f.authData = Joomla.getOptions(\"akeeba.LoginGuard.u2f.authData\", [\"\", \"\"]);\n\n    u2f.sign(\n        akeeba.LoginGuard.u2f.authData[0].appId, akeeba.LoginGuard.u2f.authData[0].challenge,\n        akeeba.LoginGuard.u2f.authData, akeeba.LoginGuard.u2f.validateCallback\n    );\n};\n\n/**\n * Callback for the U2F sign() method\n *\n * @param   {u2f.SignResponse}  response\n */\nakeeba.LoginGuard.u2f.validateCallback = function (response)\n{\n    if ((response.errorCode === undefined) || (response.errorCode === 0))\n    {\n        document.getElementById(\"loginGuardCode\").value = JSON.stringify(response);\n        document.forms[\"loginguard-captive-form\"].submit();\n\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.showError(response.errorCode);\n};\n\nwindow.addEventListener(\"DOMContentLoaded\", function (event)\n{\n    document.querySelectorAll(\".loginguard_u2f_setup\")\n            .forEach(function (elButton)\n            {\n                elButton.addEventListener('click', akeeba.LoginGuard.u2f.setUp);\n            });\n});\n"],"file":"u2f.js"}